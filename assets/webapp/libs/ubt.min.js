/*name:maosui ubt v1.0*/
/*date:2014-10-16*/
!function(a,b){function c(){var b=a.navigator.userAgent.toLowerCase();if(b.indexOf("msie")>=0){var c=b.match(/msie ([\d.]+)/)[1];return{type:"IE",version:c}}if(b.indexOf("firefox")>=0){var c=b.match(/firefox\/([\d.]+)/)[1];return{type:"Firefox",version:c}}if(b.indexOf("chrome")>=0){var c=b.match(/chrome\/([\d.]+)/)[1];return{type:"Chrome",version:c}}if(b.indexOf("opera")>=0){var c=b.match(/opera.([\d.]+)/)[1];return{type:"Opera",version:c}}if(b.indexOf("safari")>=0){var c=b.match(/version\/([\d.]+)/)[1];return{type:"Safari",version:c}}return{type:"unknow",version:"unkonw"}}function d(a){var b=function(a){return 10>a?"0"+a:a};return b(a.getFullYear())+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+" "+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())}a.UBT=a.UBT||{};var e=a.UBT;e.CST={pidId:"ubt-pid",uidId:"ubt-uid",ubtData:"ubt-data"},e.config=e.config||{},e.config.url="http://api.51lingong.com",e.config.path={visit:"/Ubt/Visit",click:"/Ubt/Click",receTraceData:"/Ubt/ReceTraceData"},e.startTime=d(new Date),e.$=function(a){return b.getElementById(a)},e.eles={pageCode:e.$(e.CST.pidId),uid:e.$(e.CST.uidId)},e.cookie={set:function(a,c){var d=new Date;d.setDate(d.getDate()+3650),b.cookie=a+"="+escape(c)+";expires="+d.toGMTString()},get:function(a){var c=0,d=0;return b.cookie.length>0&&(c=b.cookie.indexOf(a+"="),-1!=c)?(c=c+a.length+1,d=b.cookie.indexOf(";",c),-1==d&&(d=b.cookie.length),unescape(b.cookie.substring(c,d))):""}},e.newGUID=function(){for(var a="",b=1;32>=b;b++){var c=Math.floor(16*Math.random()).toString(16);a+=c}return a+=(new Date).getTime(),a.toUpperCase()},e.getUid=function(){var a="",b="";if(a=e.$(e.CST.uidId).value,!a){var b=e.cookie.get(e.CST.uidId);b?a=b:(a="UBT"+e.newGUID(),e.cookie.set(e.CST.uidId,a))}return a},e.getPid=function(){return e.$(e.CST.pidId).value},e.send=function(a,c,d){var f=e.getUid(),g=e.getPid(),h=e.config.url;if(g)return e.isAppendImg||(e.isAppendImg=!0,e.sendImg=new Image,e.sendImg.id="ubt-send-img",e.sendImg.style.display="none",e.sendImg.style.height=0,e.sendImg.style.width=0,b.body.appendChild(e.sendImg)),a.push("uid="+f),a.push("appId="+e.config.appId),a.push("t="+(new Date).getTime()),h+=c,h+="?",h+=a.join("&"),e.sendImg.src=h,e.sendImg.onload=function(){d&&d()},e.sendImg.onerror=function(){d&&d()},!0},e.getBrowser=function(){},e.saveTrace=function(a){var b=e.cookie.get(e.CST.ubtData);b?b+=";"+a:b=a,console.log(b),e.cookie.set(e.CST.ubtData,b)},e.clearTrace=function(){e.cookie.set(e.CST.ubtData,"")},e.sendTraceData=function(){var a=e.cookie.get(e.CST.ubtData);if(console.log(a),a){var b=["traceData="+encodeURIComponent(a)];e.send(b,e.config.path.receTraceData),e.clearTrace()}},e.visitPage=function(){var f=c(),g=(e.getUid(),e.getPid()),h=["viewTime="+d(new Date),"screenSize="+a.screen.width+"X"+a.screen.height,"browserName="+f.type,"browserVer="+f.version,"pid="+g,"refer="+b.referrer];e.send(h,e.config.path.visit,function(){e.sendTraceData()})},e.registerEvent=function(b,c,d){a.addEventListener?b.addEventListener(c,d,!1):a.attachEvent&&b.attachEvent("on"+c,d)},e.leavePageTrace=function(){},e.clickTrace=function(){function c(b){for(var c=(e.getUid(),e.getPid()),f=b.target||(a.event?a.event.srcElement:null);f&&f.getAttribute&&!f.getAttribute("data-ubt-click");)f=f.parentNode;if(f.getAttribute&&f.getAttribute("data-ubt-click")){var g=f.getAttribute("data-ubt-click");if(g){var h=["click",c,d(new Date),g];e.saveTrace(h.join(","))}}}a.addEventListener?b.body.addEventListener("click",c,!1):a.attachEvent&&b.body.attachEvent("onclick",c)},e.singlePageTrace=function(){e.registerEvent(a,"hashchange",function(){e.visitPage()})},e.traceStart=function(){e.visitPage()},e.start=function(){e.config.appId&&(e.visitPage(),e.leavePageTrace(),e.clickTrace())},e.start()}(window,document);